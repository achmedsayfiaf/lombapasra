<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Heartbeat | LenteraSastra Status</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-emerald-500 flex items-center justify-center min-h-screen font-mono">

    <div class="border border-emerald-500/30 p-8 rounded-2xl bg-emerald-500/5 shadow-[0_0_50px_rgba(16,185,129,0.1)]">
        <div class="flex items-center gap-4 mb-4">
            <div id="led" class="w-3 h-3 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,1)]"></div>
            <h1 class="text-xs font-black tracking-[0.4em] uppercase">System Pulse</h1>
        </div>
        
        <div id="display" class="text-4xl font-bold tracking-tighter mb-4 text-white">
            000ms
        </div>

        <div class="space-y-1">
            <p id="status-text" class="text-[10px] uppercase tracking-widest text-emerald-500/60">Synchronizing...</p>
            <p id="timestamp" class="text-[9px] text-slate-500"></p>
        </div>
    </div>

    <script>
        const SB_URL = "https://glyfbykxbpmtysnlaqcd.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdseWZieWt4YnBtdHlzbmxhcWNkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5MzQ3ODUsImV4cCI6MjA4NTUxMDc4NX0.nxPRnJ_drfP_gb_MLFbf05COk6JpjyDtHAb4g_NcwYI";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        async function pulse() {
            const t0 = performance.now();
            const led = document.getElementById('led');
            
            try {
                // Melakukan UPDATE pada satu baris data yang sama
                const { error } = await _supabase
                    .from('uptime_logs')
                    .update({ last_ping: new Date().toISOString() })
                    .eq('id', '00000000-0000-0000-0000-000000000001');

                if (error) throw error;

                const t1 = performance.now();
                const latency = Math.round(t1 - t0);

                document.getElementById('display').innerText = `${latency}ms`;
                document.getElementById('status-text').innerText = "Pulse Sent Successfully";
                document.getElementById('timestamp').innerText = new Date().toLocaleString();
                
                // Visual feedback
                led.style.backgroundColor = "#10b981";
                led.style.boxShadow = "0 0 15px #10b981";

            } catch (err) {
                document.getElementById('display').innerText = "ERR";
                document.getElementById('status-text').innerText = "Connection Failed";
                led.style.backgroundColor = "#ef4444";
                led.style.boxShadow = "0 0 15px #ef4444";
                console.error(err);
            }
        }

        // Jalankan saat halaman dibuka
        pulse();

        // UptimeRobot biasanya melakukan ping setiap 5-15 menit.
        // Script ini akan melakukan auto-pulse jika halaman tetap terbuka.
        setInterval(pulse, 300000); // 5 Menit
    </script>
</body>
</html>
